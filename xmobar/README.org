#+title:       XMobar
#+author:      Artem Smaznov
#+description: Lightweight, text-based, status bar written in Haskell
#+startup:     overview
#+auto_tangle: t

* Table of Contents :toc:
- [[#dependencies][Dependencies]]
- [[#global][Global]]
  - [[#appearance][Appearance]]
  - [[#general-behavior][General Behavior]]
  - [[#layout][Layout]]
  - [[#widgets][Widgets]]
- [[#main-monitor-template][Main Monitor Template]]
- [[#secondary-monitor-template][Secondary Monitor Template]]

* Dependencies
|----------------+----------------------|
| Name           | Description          |
|----------------+----------------------|
| [[https://archlinux.org/packages/?name=xmobar][xmobar]]         | Status Bar           |
| [[https://archlinux.org/packages/?name=trayer][trayer]]         | System Tray widget   |
|----------------+----------------------|

#+begin_example shell
sudo pacman -S xmobar trayer
#+end_example

* Global
:PROPERTIES:
:header-args: :tangle no :noweb-ref GLOBAL
:END:
** Appearance
#+begin_src haskell
Config {
   -- appearance
     font            = "Hack Nerd Font 11"
   , additionalFonts = [ "Hack Nerd Font Mono 18"       -- 1
                       , "Hack Nerd Font Mono 20"       -- 2
                       , "Hack Nerd Font Mono 28"       -- 3
                       , "Source Han Sans JP"           -- 4
                       , "Font Awesome 6 Free Solid 12" -- 5 used for workspaces in xmonad
                       , "Font Awesome 6 Free Solid 10" -- 6 used for network arrows
                       ]
   -- Start flavours
   , bgColor         = "#282828"
   , fgColor         = "#fbf1c7"
   -- End flavours
   , position        = TopH 24
#+end_src

** General Behavior
#+begin_src haskell
   , lowerOnStart     = True    -- send to bottom of window stack on start
   , hideOnStart      = False   -- start with window unmapped (hidden)
   , allDesktops      = True    -- show on all desktops
   , overrideRedirect = True    -- set the Override Redirect flag (Xlib)
   , pickBroadest     = False   -- choose widest display (multi-monitor)
   , persistent       = True    -- enable/disable hiding (True = disabled)
#+end_src

** Layout
#+begin_src haskell
   , sepChar  = "%"   -- delineator between plugin names and straight text
   , alignSep = "}{"  -- separator between left-right alignment
   , iconRoot = ".config/xmobar/xpm/"
#+end_src

** Widgets
*** Separator
#+begin_src haskell
   , commands =
        [ Run Com "echo" ["<fc=#7c6f64>|</fc>"] "sep" 36000
#+end_src

*** Logo
#+begin_src haskell
        , Run Com "echo" ["<action=`rofi -show drun`><fn=3><fc=#1793d1>\xf303</fc></fn></action>"] "logo" 36000
#+end_src

*** Time
#+begin_src haskell
        , Run Date
          "%l:%M %p"
          "time" 10
#+end_src

*** Workspaces, Layout and Window
Workspaces, layout, window name received from XMonad
#+begin_src haskell
        , Run XMonadLog
#+end_src

*** MPD
#+begin_src haskell
        , Run MPD
          ["-t", "  <statei> <fn=4><artist> - <title></fn> [<flags>]" -- ["-t", "<box type=Bottom width=2 mb=2 color=#fabd2f> <statei>  <artist> - <title> </box>"
               , "--"
               , "-P", "<fn=1></fn>" -- play icon
               , "-Z", "<fn=1></fn>" -- pause icon
               , "-S", "<fn=1></fn>" -- stop icon
               ] 10
#+end_src

*** Keyboard
Keyboard Layout Indicator
#+begin_src haskell
        , Run Com "echo" ["<action=`.local/bin/dm-scripts/dm-lang`> "] "_ks" 3600
        , Run Kbd
          [ ("us" , "<fc=#fabd2f>US</fc>")
          , ("ru" , "<fc=#458588>RU</fc>")
          , ("jp" , "<fn=4><fc=#fbf1c7>日本</fc></fn>")
          ]
        , Run Com "echo" [" </action>"] "_ke" 3600
#+end_src

*** Updates
#+begin_src haskell
        , Run Com "echo" ["<box type=Bottom width=2 mb=2 color=#fb4934><action=`alacritty -e sudo pacman -Syu`> <fn=1>\xf0f3</fn> "] "_us" 3600
        , Run Com ".local/bin/dm-scripts/helpers/updates" [] "updates" 3600
        , Run Com "echo" [" </action></box>"] "_ue" 3600
#+end_src

*** Battery
#+begin_src haskell
        , Run BatteryP ["cat /sys/class/sony_controller_battery_a0:ab:51:62:65:1d/capacity"]
          ["-t", "<acstatus><watts> <left>%"
               , "--low", "20"
               -- , "--"
               ] 100
#+end_src

*** Network
#+begin_src haskell
        , Run DynNetwork
          ["-t", "<box type=Bottom width=2 mb=2 color=#8ec07c> <fn=1>\xf484</fn> <rx> <fn=6>\xf309\xf30c</fn> <tx> </box>"
               , "-S", "True"
               , "--"
               , "--devices", "eno1,wlan0,enp2s0f0"
               ] 20
#+end_src

*** CPU
#+begin_src haskell
        , Run CoreTemp
          ["-t", "<box type=Bottom width=2 mb=2 color=#d3869b><action=`alacritty -e htop`> <fn=1>\xf85a</fn> <core0>°"
               -- High CPU Temp
               , "-H", "70"
               , "-h", "#fb4934"
               -- Low CPU Temp
               , "-L", "40"
               , "-l", "#b8bb26"
               ] 20
        , Run Cpu
          ["-t", "(<total>%) </action></box>"
               -- High CPU Load
               , "-H", "80"
               , "-h", "#fb4934"
               -- Low CPU Load
               , "-L", "5"
               , "-l", "#b8bb26"
               ] 20
#+end_src

*** RAM
#+begin_src haskell
        , Run Memory
          ["-t", "<box type=Bottom width=2 mb=2 color=#83a598><action=`alacritty -e htop`> <fn=1>\xf2db</fn> <used> M (<usedratio>%) </action></box>"
               ] 20
#+end_src

*** Volume
#+begin_src haskell
        , Run Volume "default" "Master"
          ["-t", "<box type=Bottom width=2 mb=2 color=#b8bb26><action=`alacritty -e alsamixer`> <status> <volume>%</action> </box>"
               , "--"
               -- ON Icon
               , "-O", "<fn=2>\xfa7d</fn>"
               , "-C", "#b8bb26"
               -- OFF Icon
               , "-o", "<fn=2>\xfa80</fn>"
               , "-c", "#fb4934"
               ] 10
#+end_src

*** Date
#+begin_src haskell
        , Run Date
          "<action=`emacsclient -c -a 'emacs' --eval '(cfw:open-org-calendar)'`><fn=1>\xf5f5</fn> %a, %d %b %Y</action>"
          "date" 3600
#+end_src

*** Up-time
#+begin_src haskell
        , Run Uptime
          ["-t", "<box type=Bottom width=2 mb=2 color=#fabd2f> <fn=2>\xf0aa</fn> <days>d <hours>h </box>"
               ] 3600
#+end_src

*** Trayer
Script that dynamically adjusts xmobar padding depending on number of trayer icons.
#+begin_src haskell
        , Run Com ".config/xmobar/trayer-padding-icon.sh" [] "trayerpad" 20
]
#+end_src

* Main Monitor Template
#+begin_src haskell :noweb yes :tangle mainScreen.hs
<<GLOBAL>>
   , template = " %logo%%time% %sep%%XMonadLog% }{ %mpd% %sep%%_ks%%kbd%%_ke%%sep% %_us%%updates%%_ue% %coretemp%%cpu% %default:Master% %sep% %date% "
   }
#+end_src

* Secondary Monitor Template
#+begin_src haskell :noweb yes :tangle secondaryScreen.hs
<<GLOBAL>>
   , template = " %logo%%time% %sep%%XMonadLog% } { %kbd% %sep% %default:Master% %uptime% %sep% %date% %trayerpad%"
   }
#+end_src
